<header
  class="header-container"
>
  <!-- Progress Bar -->
  <mat-progress-bar
    *ngIf="busyService.isBusy$ | async"
    mode="indeterminate"
    class="progress-bar"
  >
  </mat-progress-bar>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 lg:h-20">
      <!-- Logo Section -->
      <img
        routerLink="/"
        src="assets/images/logo.svg"
        alt="Logo"
        class="h-6 lg:h-8"
      />

      <!-- Navigation -->
      <nav class="hidden lg:flex items-center space-x-8">
        <a
          routerLink="/"
          routerLinkActive="active"
          class="nav-link group"
          [routerLinkActiveOptions]="{ exact: true }"
        >
          <span class="nav-text">Home</span>
          <div class="nav-underline"></div>
        </a>
        <a routerLink="/shop" routerLinkActive="active" class="nav-link group">
          <span class="nav-text">Shop</span>
          <div class="nav-underline"></div>
        </a>
        <a routerLink="/about" routerLinkActive="active" class="nav-link group">
          <span class="nav-text">About</span>
          <div class="nav-underline"></div>
        </a>
      </nav>

      <!-- Actions -->
      <div class="flex items-center space-x-4">
        <!-- Cart -->
        <app-cart-summary></app-cart-summary>

        <!-- Auth Buttons -->
        <div class="auth-section">
          <!-- User logged in -->
          @if (authService.authState$ | async; as authState) {
            @if (authState.isAuthenticated && authState.user) {
              <div class="user-menu">
                <button 
                  mat-button 
                  [matMenuTriggerFor]="userMenu"
                  class="user-button"
                >
                  <mat-icon>account_circle</mat-icon>
                  <span class="user-name">{{ authState.user.firstName }}</span>
                  <mat-icon class="dropdown-icon">arrow_drop_down</mat-icon>
                </button>
                
                <mat-menu #userMenu="matMenu" class="user-dropdown">
                  <div class="user-info">
                    <div class="user-email">{{ authState.user.email }}</div>
                    <div class="user-full-name">{{ authState.user.firstName }} {{ authState.user.lastName }}</div>
                  </div>
                  <mat-divider></mat-divider>
                  <button mat-menu-item routerLink="/profile">
                    <mat-icon>person</mat-icon>
                    <span>Profilo</span>
                  </button>
                  <button mat-menu-item routerLink="/orders">
                    <mat-icon>receipt</mat-icon>
                    <span>I miei ordini</span>
                  </button>
                  <mat-divider></mat-divider>
                  <button mat-menu-item (click)="logout()" class="logout-button">
                    <mat-icon>logout</mat-icon>
                    <span>Logout</span>
                  </button>
                </mat-menu>
              </div>
            } @else {
              <!-- User not logged in -->
              <div class="guest-buttons">
                <button mat-button routerLink="/login" class="btn-ghost">
                  <mat-icon>login</mat-icon>
                  Accedi
                </button>
                <button mat-raised-button routerLink="/register" class="btn-primary">
                  <mat-icon>person_add</mat-icon>
                  Registrati
                </button>
              </div>
            }
          }
          
          <!-- Test button (development only) -->
          <button 
            mat-icon-button 
            (click)="testProgressBar()" 
            title="Test Progress Bar"
            class="test-button"
          >
            <mat-icon>science</mat-icon>
          </button>
        </div>

        <!-- Mobile Menu -->
        <button class="mobile-menu-btn lg:hidden">
          <mat-icon>menu</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Navigation Overlay (add this to the component logic) -->
  <div class="lg:hidden mobile-nav hidden">
    <div class="bg-white border-t border-gray-200 px-4 py-6 space-y-4">
      <!-- Mobile Navigation Links -->
      <div class="space-y-3">
        <a
          routerLink="/"
          class="block py-3 px-4 text-gray-700 hover:bg-gray-50 rounded-xl transition-colors duration-200"
          >Home</a
        >
        <a
          routerLink="/shop"
          class="block py-3 px-4 text-gray-700 hover:bg-gray-50 rounded-xl transition-colors duration-200"
          >Shop</a
        >
        <a
          routerLink="/about"
          class="block py-3 px-4 text-gray-700 hover:bg-gray-50 rounded-xl transition-colors duration-200"
          >About</a
        >
      </div>

      <!-- Mobile Auth Buttons -->
      <div class="flex flex-col space-y-3 pt-6 border-t border-gray-200">
        <button class="btn-ghost w-full">Accedi</button>
        <button class="btn-primary w-full">Registrati</button>
      </div>
    </div>
  </div>
</header>
